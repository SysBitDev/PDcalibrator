### README для бібліотеки `dsp_fd`

#### Огляд
`dsp_fd` — це ефективна бібліотека для обробки цифрових сигналів у частотній області. Вона надає функції для аналізу сигналів за допомогою алгоритму Гьорцеля, FFT (ШПФ) та інших методів. Бібліотека підтримує візуалізацію результатів і калібрування для різних застосувань, зокрема для визначення напрямку на основі фотодіодів.

---

#### Можливості
- **Частотний аналіз**:
  - Підтримка аналізу сигналів за допомогою алгоритму Гьорцеля та FFT.
  - Обробка даних у реальному часі для декількох каналів.
- **Візуалізація сигналів**:
  - Малювання векторів сигналів та їхніх траєкторій.
  - Гнучке налаштування параметрів відображення (розмір сітки, кольорове кодування тощо).
- **Калібрування**:
  - Інструменти для корекції векторів.
- **Налаштовувані параметри**:
  - Регульована частота дискретизації, розмір буфера та кількість каналів.
  - Підтримка аналізу кількох частот.

---

#### Опції конфігурації
| **Параметр**                | **Значення за замовчуванням** | **Опис**                                                                     |
|-----------------------------|-----------------------------|-----------------------------------------------------------------------------|
| `DSP_FD_CHANNEL_NUM_MAX`    | `12UL`                      | Максимальна кількість каналів.                                               |
| `DSP_FD_CHANNEL_NUM`        | `4UL`                       | Кількість активних каналів.                                                  |
| `DSP_FD_SAMPLING_RATE`      | `4000UL`                    | Частота дискретизації у Гц.                                                  |
| `DSP_FD_BUF_SIZE`           | `1500UL`                    | Розмір буфера для кожного каналу.                                            |
| `DSP_FD_FRQ_NUM`            | `2UL`                       | Кількість частот для аналізу.                                                |
| `GOERTZEL_MASHTAB`          | `3`                         | Масштабуючий коефіцієнт для результатів Гьорцеля.                            |
| `FD_DSP_TRAIN_DOTS`         | `90`                        | Кількість точок для візуалізації траєкторій.                                  |
| `GRID_SIZE`                 | `17`                        | Розмір клітинок сітки на екрані.                                             |
| `MARK_SIZE`                 | `15`                        | Розмір маркерів для відображення сигналів.                                   |

---

#### Структура файлів
- **Заголовкові файли**:
  - `dsp_fd.h`: Основний інтерфейс бібліотеки.
- **Файли вихідного коду**:
  - Реалізують основні алгоритми, інструменти калібрування та функції візуалізації.

---

#### Використання

##### Ініціалізація
Перед використанням бібліотеки необхідно виконати ініціалізацію:
```c
void fd_dsp_init(void);
```

##### Налаштування параметрів
- Встановити частоту дискретизації:
  ```c
  void fd_dsp_sample_rate_set(FLOAT sr);
  ```
- Встановити розмір буфера:
  ```c
  void fd_dsp_buf_size_set(U32 size);
  ```

##### Налаштування частот
Встановлення або отримання частоти для конкретного каналу:
```c
void fd_dsp_frq_set(U32 channel, FLOAT frequency);
FLOAT fd_dsp_frq_get(U32 channel);
```

##### Обробка сигналів
- Обробка даних за допомогою алгоритму Гьорцеля (версія 1 або 3) або FFT:
  ```c
  void fd_dsp_process_v1(U16 *data, fd_data_t *result);
  void fd_dsp_process_v3(U16 *data, fd_data_t *result);
  ```
- Отримання обчисленого вектора:
  ```c
  void fd_dsp_vector_get(fd_data_t *data, FLOAT amplitude);
  ```

##### Візуалізація
- Відображення траєкторій та векторів сигналу:
  ```c
  void fd_dsp_draw(fd_data_t *data, U8 mode, U32 multiplier);
  ```

---

#### Структури даних
1. **`fd_data_t`**:
   Зберігає результати обробки сигналу.
   ```c
   typedef struct {
       U32 v[DSP_FD_CHANNEL_NUM_MAX * DSP_FD_FRQ_NUM];  // Дані про амплітуду.
       U32 rssi[DSP_FD_CHANNEL_NUM_MAX * DSP_FD_FRQ_NUM]; // Рівень сигналу.
       U32 snr[DSP_FD_CHANNEL_NUM_MAX]; // Співвідношення сигнал/шум.
       FLOAT x[2]; // X-координати для векторів напрямку.
       FLOAT y[2]; // Y-координати для векторів напрямку.
   } fd_data_t;
   ```

2. **`FD_MODE`**:
   Перелік можливих режимів роботи.
   ```c
   typedef enum {
       FD_MODE_SELF_TEST,
       FD_MODE_RUN,
       FD_MODE_RESET,
       FD_MODE_CALIBRATE,
   } FD_MODE;
   ```

---

#### Приклади

1. **Ініціалізація та налаштування**:
   ```c
   #include "dsp_fd.h"

   fd_data_t fd_result;

   void setup() {
       fd_dsp_init();
       fd_dsp_sample_rate_set(4000.0);
       fd_dsp_buf_size_set(1024);
       fd_dsp_frq_set(0, 1209.0); // Встановити частоту для каналу 0
   }
   ```

2. **Обробка сигналу**:
   ```c
   void process_signal(U16 *data) {
       fd_dsp_process_v1(data, &fd_result);
   }
   ```

3. **Візуалізація результатів**:
   ```c
   void draw_results() {
       fd_dsp_draw(&fd_result, 1, 1);
   }
   ```

---

#### Обмеження
- Переконайтеся, що розмір буфера не перевищує доступну статичну пам'ять.
- Частоти мають бути нижче половини частоти дискретизації (критерій Найквіста).