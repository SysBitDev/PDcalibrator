# Бібліотека FILTER

## Опис

Бібліотека FILTER забезпечує реалізацію різних цифрових фільтрів, включаючи:

1. **Фільтр Кальмана** - для згладжування даних і компенсації шуму.
2. **Арифметичні середні фільтри** - для усереднення даних.
3. **Медіанні фільтри** - для видалення вибросів у сигналах.
4. **Віконні фільтри** - для створення згладжених сигналів із використанням віконної функції.

Ця бібліотека особливо корисна в системах реального часу для роботи з датчиками та обробкою сигналів.

---

## Інтеграція

### Підключення бібліотеки

1. Додайте файл `_filter.h` у ваш проект.
2. Підключіть його у вихідному коді:
   ```c
   #include "_filter.h"
   ```

### Залежності

Для роботи бібліотека вимагає:
- `board.h`
- `_misc.h`

---

## Функції та їх використання

### 1. Фільтр Кальмана

#### Опис структури `filter_Kalman_t`
Структура для роботи з фільтром Кальмана:
```c
typedef struct _filter_Kalman_t {
    FLOAT X0; // Передбачений стан
    FLOAT P0; // Передбачена коварація
    FLOAT F;  // Множник реального значення до попереднього
    FLOAT H;  // Множник вимірюваного значення
    FLOAT Q;  // Шум вимірювання
    FLOAT R;  // Шум середовища
    FLOAT state;      // Поточний стан
    FLOAT covariance; // Поточна коварація
} filter_Kalman_t;
```

#### Ініціалізація фільтра

```c
void filter_Kalman_init(filter_Kalman_t *pf, FLOAT f, FLOAT h, FLOAT q, FLOAT r);
```
- **Опис:** Ініціалізує фільтр Кальмана з конкретними параметрами.
- **Аргументи:**
  - `pf`: Вказівник на структуру фільтра.
  - `f`: Множник реального стану.
  - `h`: Множник виміряного стану.
  - `q`: Шум вимірювань.
  - `r`: Шум середовища.

#### Використання фільтра

```c
FLOAT filter_Kalman(filter_Kalman_t *pf, FLOAT value);
```
- **Опис:** Фільтрує вхідне значення, повертаючи згладжений результат.
- **Приклад:**
   ```c
   filter_Kalman_t kalman;
   filter_Kalman_init(&kalman, 1, 1, 0.01, 1);
   FLOAT filtered_value = filter_Kalman(&kalman, raw_value);
   ```

---

### 2. Арифметичні фільтри

#### Обчислення середнього значення (16-бітові дані)
```c
U16 filter_16bit_arithmetic_mean(U16 *adc_buf, U32 size);
```
- **Опис:** Повертає середнє значення з буфера даних.
- **Аргументи:**
  - `adc_buf`: Масив вхідних даних.
  - `size`: Розмір буфера.
- **Приклад:**
   ```c
   U16 buffer[10] = {100, 110, 120, 130, 140, 150, 160, 170, 180, 190};
   U16 mean = filter_16bit_arithmetic_mean(buffer, 10);
   ```

#### Обчислення середнього значення (32-бітові дані)
```c
S32 filter_arifm32(S32 *adc_buf, U32 size, S32 sample);
```
- **Опис:** Додає нове значення до буфера та повертає середнє значення.
- **Аргументи:**
  - `adc_buf`: Масив даних (з останнім елементом, що зберігає індекс буфера).
  - `size`: Розмір буфера.
  - `sample`: Нове значення.

---

### 3. Медіанні фільтри

#### Медіанний фільтр (16-бітові дані)
```c
U16 filter_median16(U16 *adc_buf, U32 size, U16 sample, U16 *tmp_buf);
```
- **Опис:** Повертає медіанне значення з буфера, додаючи нове значення.
- **Приклад:**
   ```c
   U16 buffer[10] = {100, 110, 120, 130, 140, 150, 160, 170, 180, 190};
   U16 temp[10];
   U16 median = filter_median16(buffer, 10, 145, temp);
   ```

#### Медіанний фільтр (32-бітові дані)
```c
S32 filter_median32(S32 *adc_buf, U32 size, S32 sample, S32 *tmp_buf);
```

---

### 4. Віконні фільтри

#### Віконний фільтр (32-бітові дані)
```c
S32 filter_window_S32(filter_window_32b_t *pf, S32 ns);
```
- **Опис:** Фільтрує дані, повертаючи згладжене значення.
- **Аргументи:**
  - `pf`: Вказівник на структуру фільтра.
  - `ns`: Нове значення.

#### Віконний фільтр (FLOAT)
```c
FLOAT filter_window_FLOAT(filter_window_FLOAT_t *pf, FLOAT ns);
```

---

## Приклад використання

### Фільтр Кальмана
```c
#include "_filter.h"

int main() {
    filter_Kalman_t kalman;
    filter_Kalman_init(&kalman, 1, 1, 0.01, 1);
    filter_Kalman_set_state(&kalman, 0, 0.5);

    FLOAT raw_data[] = {1.2, 2.5, 3.1, 4.6, 5.0};
    for (int i = 0; i < 5; i++) {
        FLOAT filtered = filter_Kalman(&kalman, raw_data[i]);
        printf("Filtered: %.2f\n", filtered);
    }
    return 0;
}
```

### Арифметичний фільтр
```c
U16 buffer[10] = {100, 110, 120, 130, 140, 150, 160, 170, 180, 190};
U16 mean = filter_16bit_arithmetic_mean(buffer, 10);
printf("Mean: %u\n", mean);
```

### Медіанний фільтр
```c
U16 buffer[10] = {100, 110, 120, 130, 140, 150, 160, 170, 180, 190};
U16 temp[10];
U16 median = filter_median16(buffer, 10, 145, temp);
printf("Median: %u\n", median);
```